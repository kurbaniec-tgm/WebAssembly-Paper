"use strict";var MainThread=function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function r(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];t=n}else t=void 0;if(t||(t=Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?Array.from(e):void 0),!(e=t))throw new TypeError("Invalid attempt to spread non-iterable instance");return e}function u(e,t,n,r,o,i){for(var a=[],s=0;s<n;s++)switch(e[t++]){case 1:a.push(e[t++]);break;case 2:k[0]=e[t++],k[1]=e[t++],a.push(S[0]);break;case 3:a.push(r.get(e[t++]));break;case 4:var c=e[t++];t=u(e,t,c,r,o,i),a.push(t.args),t=t.offset;break;case 5:if(!i)throw Error("objectContext not provided.");a.push(i.get(e[t++]));break;case 6:c=o.getNode(e[t++]),a.push(c.getContext("2d"));break;case 7:a.push(o.getNode(e[t++]));break;default:throw Error("Cannot deserialize argument.")}return{args:a,offset:t}}function a(e,t){if(!e)throw Error("Property ".concat(t," does not exist on ").concat(e,"."));var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"set"in n:a(Object.getPrototypeOf(e),t)}function s(e,t,n,r){var i,u=[].slice.call(e.childNodes).filter(n);return o(i={},7,e._index_),o(i,11,0),o(i,0,e.nodeType),o(i,1,t(e.localName||e.nodeName)),o(i,4,u.map((function(e){return s(e,t,n,r)}))),o(i,2,[].map.call(e.attributes||[],(function(e){return[t(e.namespaceURI||"null"),t(e.name),t(e.value)]}))),u=i,null!=e.namespaceURI&&(u[6]=t(e.namespaceURI)),j.includes(e.nodeType)&&null!==e.textContent&&(u[5]=t(e.textContent)),m(r,e),N(r,e),u}function c(e){var t={nodeType:e[0],name:e[1],attributes:null,childNodes:null},n=e[2];return n&&(t.attributes=n.map((function(e){return{name:e[1],value:e[2]}}))),(e=e[4])&&(t.childNodes=e.map(c)),t}function l(e,t){var n=function(t){return"number"==typeof t||"boolean"==typeof t?void 0!==t?t:null:null!=t?z(e,t):null};return{type:t[12],bubbles:n(t[25]),cancelable:n(t[26]),cancelBubble:n(t[27]),defaultPrevented:n(t[29]),eventPhase:n(t[30]),isTrusted:n(t[31]),returnValue:n(t[32]),currentTarget:n(t[28]),target:n(t[13]),scoped:n(t[34]),keyCode:n(t[35])}}function f(e,t){return function(e,t,n){var r=new P,o=new W,i=new U(r,t),u=function(e){return Object.assign({},{mutationPump:requestAnimationFrame.bind(null),executorsAllowed:g},e)}(n);return e.then((function(e){var a=function(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){n=[];var r=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}}else n=void 0;if(!(e=n))throw new TypeError("Invalid attempt to destructure non-iterable instance");return e}(e,2);if(e=a[0],a=a[1],e&&a&&n.authorURL){e=new B(t,i,e,a,u);var s=new L(r,i,e,u,o);return e.worker.onmessage=function(e){var t=e.data;D.includes(t[12])&&(s.mutate(t[54],t[37],t[41],new Uint16Array(t[36])),n.onReceiveMessage)&&n.onReceiveMessage(e)},e.worker}return null}))}(Promise.all([fetch(t.domURL).then((function(e){return e.text()})),fetch(t.authorURL).then((function(e){return e.text()}))]),e,t)}var d=function(e,t,n,r,i){var u=i.executorsAllowed.includes(8);return{execute:function(e,r){if(u){var i,a=e[r+1];if(e=t.getNode(a))a=e.transferControlToOffscreen(),n.messageToWorker((o(i={},12,9),o(i,13,[e._index_]),o(i,38,a),i),[a]);else console.error("'OFFSCREEN_CANVAS_INSTANCE': getNode(".concat(a,") is null."))}return r+2},print:function(e,t,n){return{type:"OFFSCREEN_CANVAS_INSTANCE",target:n,allowedExecution:u}}}},g=[0,1,2,3,4,5,6,7,8,9,10,11,12],v={0:"ATTRIBUTES",1:"CHARACTER_DATA",2:"CHILD_LIST",3:"PROPERTIES",4:"EVENT_SUBSCRIPTION",5:"GET_BOUNDING_CLIENT_RECT",6:"LONG_TASK_START",7:"LONG_TASK_END",8:"OFFSCREEN_CANVAS_INSTANCE",9:"OBJECT_MUTATION",10:"OBJECT_CREATION",11:"IMAGE_BITMAP_INSTANCE",12:"STORAGE"},h=new Map,p=function(e){return e&&"value"in e},m=function(e,t){p(t)&&null===t.oninput&&(t.oninput=function(){return y(e,t)})},N=function(e,t){p(t)&&!h.get(t)&&(new MutationObserver((function(t){return t.map((function(t){return y(e,t.target)}))})).observe(t,{attributes:!0}),h.set(t,!0))},y=function(e,t){var n,r;return e.messageToWorker((o(r={},12,4),o(r,40,(o(n={},7,t._index_),o(n,21,t.value),n)),r))},w=function(e){return Object.values(e).map((function(e){return[e.identifier,e.screenX,e.screenY,e.clientX,e.clientY,e.pageX,e.pageY,e.target._index_]}))},E=function(e,t,n,r,i){var u=[],a=i.executorsAllowed.includes(4),s=[window.innerWidth,window.innerHeight],c=function(e){return function(t){var r,i;if(p(t.currentTarget))y(n,t.currentTarget);else if("resize"===t.type){var u,a=window,c=a.innerHeight;if(s[0]===a.innerWidth&&s[1]===c)return;a=s=[window.innerWidth,window.innerHeight],n.messageToWorker((o(u={},12,5),o(u,40,a),u))}n.messageToWorker((o(i={},12,1),o(i,39,(o(r={},7,e),o(r,25,t.bubbles),o(r,26,t.cancelable),o(r,27,t.cancelBubble),o(r,28,[t.currentTarget._index_||0]),o(r,29,t.defaultPrevented),o(r,30,t.eventPhase),o(r,31,t.isTrusted),o(r,32,t.returnValue),o(r,13,[t.target._index_||0]),o(r,33,t.timeStamp),o(r,12,t.type),o(r,35,"keyCode"in t?t.keyCode:void 0),o(r,60,"pageX"in t?t.pageX:void 0),o(r,61,"pageY"in t?t.pageY:void 0),o(r,65,"offsetX"in t?t.offsetX:void 0),o(r,66,"offsetY"in t?t.offsetY:void 0),o(r,62,"touches"in t?w(t.touches):void 0),o(r,63,"changedTouches"in t?w(t.changedTouches):void 0),r)),i))}};return{execute:function(r,o){var i=r[o+2],s=o+4+2*i;if(i=o+4+2*(r[o+3]+i),a){var l=r[o+1],f=t.getNode(l);if(f)for(o+=4;o<i;o+=2){l=f;var d=o<=s,g=e.get(r[o]),v=r[o+1];if(l===t.baseElement)d?addEventListener(g,u[v]=c(1)):removeEventListener(g,u[v]);else{var h=null!==l.oninput,y="change"===g;d?(y&&(h=!0,l.onchange=null),l.addEventListener(g,u[v]=c(l._index_))):(y&&(h=!1),l.removeEventListener(g,u[v])),p(l)&&(h||m(n,l),N(n,l))}}else console.error("getNode(".concat(l,") is null."))}return i},print:function(t,n,r){var o=t[n+2],i=n+4+2*o;o=n+4+2*(t[n+3]+o);var u=[],s=[];for(n+=4;n<o;n+=2)(n<=i?s:u).push({type:e.get(t[n]),index:t[n+1]});return{target:r,allowedExecution:a,removedEventListeners:u,addedEventListeners:s}}}},T=function(e,t,n,r,i){var u=i.executorsAllowed.includes(5);return{execute:function(e,r){if(u){var i,a=e[r+1];if(e=t.getNode(a))a=e.getBoundingClientRect(),n.messageToWorker((o(i={},12,6),o(i,13,[e._index_]),o(i,38,[a.top,a.right,a.bottom,a.left,a.width,a.height]),i));else console.error("GET_BOUNDING_CLIENT_RECT: getNode(".concat(a,") is null."))}return r+2},print:function(e,n){return{type:"GET_BOUNDING_CLIENT_RECT",target:t.getNode(e[n+1]),allowedExecution:u}}}},x=function(e,t,n,r,o){var i=t.getNode,u=o.executorsAllowed.includes(2);return{execute:function(e,t){var r=e[t+4],o=e[t+5];if(u){var a=e[t+1],s=i(a);s?(0<o&&e.slice(t+6+r,t+6+r+o).forEach((function(e){var t=i(e);t?t.remove():console.error("CHILD_LIST: getNode(".concat(e,") is null."))})),0<r&&e.slice(t+6,t+6+r).forEach((function(r){var o=e[t+2];(r=i(r))&&(s.insertBefore(r,o&&i(o)||null),m(n,r),N(n,r))}))):console.error("CHILD_LIST: getNode(".concat(a,") is null."))}return t+6+r+o},print:function(e,t){var n=i(e[t+1]),r=e[t+4],o=Array.from(e.slice(t+6+r,t+6+r+e[t+5])).map((function(e){return i(e)||e}));return r=Array.from(e.slice(t+6,t+6+r)).map((function(e){return i(e)||e})),{target:n,allowedExecution:u,nextSibling:i(e[t+2])||null,previousSibling:i(e[t+3])||null,addedNodes:r,removedNodes:o}}}},b=function(e,t,n,r,o){var i=o.executorsAllowed.includes(0),u=function(t,n){return 0!==(t=t[n+4])?e.get(t-1):null};return{execute:function(n,r){if(i){var a=n[r+1],s=t.getNode(a),c=e.get(n[r+2]);n=u(n,r),s?null!=c&&(o.sanitizer?o.sanitizer.setAttribute(s,c,n):null==n?s.removeAttribute(c):s.setAttribute(c,n)):console.error("ATTR_LIST: getNode(".concat(a,") is null."))}return r+5},print:function(n,r){var o=t.getNode(n[r+1]),a=e.get(n[r+2]);return n=u(n,r),{target:o,allowedExecution:i,attributeName:a,value:n,remove:null==n}}}},A=function(e,t,n,r,o){var i=o.executorsAllowed.includes(1);return{execute:function(n,r){if(i){var o=n[r+1],u=t.getNode(o);n=n[r+2],u?n&&(u.textContent=e.get(n)):console.error("CHAR_DATA: getNode(".concat(o,") is null."))}return r+3},print:function(n,r){return{target:t.getNode(n[r+1]),allowedExecution:i,value:e.get(n[r+2])}}}},C=function(e,t,n,r,o){var i=o.executorsAllowed.includes(3),u=function(t,n){var r=t[n+4];return 1===t[n+3]?1===r:0!==r?e.get(r):null};return{execute:function(n,r){if(i){var a=n[r+1],s=t.getNode(a),c=e.get(n[r+2]);n=u(n,r),s?c&&null!=n&&(o.sanitizer?o.sanitizer.setProperty(s,c,String(n)):s[c]=n):console.error("PROPERTY: getNode(".concat(a,") is null."))}return r+5},print:function(n,r){return{target:t.getNode(n[r+1]),name:e.get(n[r+2]),value:n=u(n,r),allowedExecution:i}}}},_=function(e,t,n,r,o){var i,u=o.executorsAllowed.includes(6),a=0;return{execute:function(e,t){return u&&o.longTask&&(6===e[t]?(a++,i||o.longTask(new Promise((function(e){return i=e})))):7===e[t]&&(a--,i&&0>=a&&(i(),i=null,a=0))),t+2},print:function(e,t){return{type:v[e[t]],allowedExecution:u}},get active(){return null!==i}}},S=new Float32Array(1),k=new Uint16Array(S.buffer),O=function(e,t,n,r,o){var s=o.executorsAllowed.includes(9);return{execute:function(n,o){var c=e.get(n[o+1]),l=n[o+2],f=u(n,o+3,1,e,t,r);return o=f.args[0],n=(l=u(n,f.offset,l,e,t,r)).offset,l=l.args,s&&(a(o,c)?o[c]=l[0]:o[c].apply(o,i(l))),n},print:function(n,o){var i=e.get(n[o+1]);return{type:"OBJECT_MUTATION",target:n=u(n,o+3,1,e,t,r).args[0],functionName:i,isSetter:a(n,i),allowedExecution:s}}}},I=function(e,t,n,r,o){var a=o.executorsAllowed.includes(10);if(!r)throw Error("objectContext is not defined.");return{execute:function(n,o){var s=e.get(n[o+1]),c=n[o+2],l=n[o+3],f=u(n,o+4,1,e,t,r);return o=f.args[0],n=(l=u(n,f.offset,l,e,t,r)).offset,l=l.args,a&&"new"!==s&&r.store(c,o[s].apply(o,i(l))),n},print:function(n,o){var i=e.get(n[o+1]),s=n[o+2],c=n[o+3];return{type:"OBJECT_CREATION",target:u(n,o+4,1,e,t,r).args[0],functionName:i,objectId:s,argCount:c,allowedExecution:a}}}},R=function(e,t,n,r,i){var u=i.executorsAllowed.includes(11);return{execute:function(e,r){if(u){var i=e[r+1],a=t.getNode(i);a?self.createImageBitmap(a).then((function(t){var i;n.messageToWorker((o(i={},12,10),o(i,73,e[r+2]),o(i,38,t),i),[t])})):console.error("IMAGE_BITMAP_INSTANCE: getNode(".concat(i,") is null."))}return r+3},print:function(e,n){return{type:"IMAGE_BITMAP_INSTANCE",target:t.getNode(e[n+1]),allowedExecution:u,callIndex:e[n+2]}}}},M=function(e,t,n,r,i){var u=i.executorsAllowed.includes(12),a=function(e,t){i.sanitizer&&2===e?i.sanitizer.getStorage(e,t).then((function(r){var i;o(i={},12,11),o(i,74,t||""),o(i,75,e),o(i,21,r),r=i,n.messageToWorker(r)})):console.error("STORAGE: Sanitizer not found or unsupported location:",e)};return{execute:function(t,n){if(u){var r=t[n+1],o=t[n+2],s=t[n+3];if(t=t[n+4],s=0<s?e.get(s):null,t=0<t?e.get(t):null,1===r)a(o,s);else if(2===r)if(i.sanitizer)i.sanitizer.setStorage(o,s,t);else{if(0===o)var c=window.localStorage;else 1===o&&(c=window.sessionStorage);if(c)if(null==s){if(null!=t)throw Error("Unexpected storage operation.");c.clear()}else null==t?c.removeItem(s):c.setItem(s,t);else console.error('STORAGE: Unexpected location: "'.concat(o,'".'))}}return n+5},print:function(t,n){var r=t[n+1],o=t[n+2],i=t[n+3];return t=t[n+4],{type:"STORAGE",operation:r,location:o,key:i=0<i?e.get(i):null,value:t=0<t?e.get(t):null,allowedExecution:u}}}},L=function(){function e(n,r,i,u,a){var s,c=this;t(this,e),this.mutationQueue=[],this.pendingMutations=!1,this.syncFlush=function(){c.mutationQueue.forEach((function(e){for(var t=0,n=e.length;t<n;){var r=e[t],o=c.executors[r];console.log(v[r],o.print(e,t)),t=o.execute(e,t)}})),c.mutationQueue=[],c.pendingMutations=!1},this.stringContext=n,this.nodeContext=r,this.sanitizer=u.sanitizer,this.mutationPumpFunction=u.mutationPump,n=[n,r,i,a,u],r=_.apply(null,n),this.executors=(o(s={},2,x.apply(null,n)),o(s,0,b.apply(null,n)),o(s,1,A.apply(null,n)),o(s,3,C.apply(null,n)),o(s,4,E.apply(null,n)),o(s,5,T.apply(null,n)),o(s,6,r),o(s,7,r),o(s,8,d.apply(null,n)),o(s,9,O.apply(null,n)),o(s,10,I.apply(null,n)),o(s,11,R.apply(null,n)),o(s,12,M.apply(null,n)),s)}return r(e,[{key:"mutate",value:function(e,t,n,r){this.stringContext.storeValues(n),this.nodeContext.createNodes(t,this.sanitizer),this.mutationQueue=this.mutationQueue.concat(r),this.pendingMutations||(this.pendingMutations=!0,this.mutationPumpFunction(this.syncFlush,e))}}]),e}(),U=function(){function e(n,r){var o=this;t(this,e),this.createNodes=function(e,t){for(var n=(e=new Uint16Array(e)).length,r=0;r<n;r+=5){if(3===e[r+1])var i=document.createTextNode(o.stringContext.get(e[r+3]));else if(8===e[r+1])i=document.createComment(o.stringContext.get(e[r+3]));else if(11===e[r+1])i=document.createDocumentFragment();else if(i=o.stringContext.get(e[r+2]),i=0!==e[r+4]?document.createElementNS(o.stringContext.get(e[r+4]),i):document.createElement(i),t&&!t.sanitize(i))continue;o.storeNode(i,e[r])}},this.getNode=function(e){return(e=o.nodes.get(e))&&"BODY"===e.nodeName?o.baseElement:e},this.storeNodes=function(e){o.storeNode(e,++o.count),e.childNodes.forEach((function(e){return o.storeNodes(e)}))},this.count=2,this.stringContext=n,this.nodes=new Map([[1,r],[2,r]]),this.baseElement=r,r._index_=2,r.childNodes.forEach((function(e){return o.storeNodes(e)}))}return r(e,[{key:"storeNode",value:function(e,t){e._index_=t,this.nodes.set(t,e)}}]),e}(),P=function(){function e(){t(this,e),this.strings=[]}return r(e,[{key:"get",value:function(e){return this.strings[e]||""}},{key:"store",value:function(e){this.strings.push(e)}},{key:"storeValues",value:function(e){var t=this;e.forEach((function(e){return t.store(e)}))}}]),e}(),j=[8,3],z=function(e,t){return null!=t&&e.getNode(t[0])||t},B=function(){function e(n,r,o,i,u){t(this,e),this.nodeContext=r,this.config=u;var a=function(e,t,n){t=t.hydrateFilter||function(){return!0};var r=[],o=new Map;return{skeleton:s(e,(function(e){if(o.has(e))return o.get(e);var t=r.length;return o.set(e,t),r.push(e),t}),t,n),strings:r}}(n,u,this);r=a.skeleton,a=a.strings;var l,f=[],d=[],g=u.sanitizer?u.sanitizer.getStorage(0):window.localStorage,v=u.sanitizer?u.sanitizer.getStorage(1):window.sessionStorage;for(l in n.style)f.push(l);for(var h in n)h.startsWith("on")&&d.push(h);o="'use strict';(function(){".concat(o,"self['window']=self;var workerDOM=WorkerThread.workerDOM;WorkerThread.hydrate(workerDOM.document,").concat(JSON.stringify(a),",").concat(JSON.stringify(r),",").concat(JSON.stringify(f),",").concat(JSON.stringify(d),",[").concat(window.innerWidth,",").concat(window.innerHeight,"],").concat(JSON.stringify(g),",").concat(JSON.stringify(v),");workerDOM.document[",59,"](this);Object.keys(workerDOM).forEach(key => self[key]=workerDOM[key]);}).call(self);").concat(i,"//# sourceURL=").concat(encodeURI(u.authorURL)),this[55]=new Worker(URL.createObjectURL(new Blob([o]))),console.info("debug","hydratedNode",c(function(e,t,n){return s(e,(function(e){return e}),t.hydrateFilter||function(){return!0},n)}(n,u,this))),u.onCreateWorker&&u.onCreateWorker(n,a,r,f)}return r(e,[{key:"messageToWorker",value:function(e,t){console.info("debug","messageToWorker",function(e,t){if(1==t[12])return{type:"EVENT",event:l(e,t[39])};if(4==t[12]){var n=(t=t[40])[7];return{type:"SYNC",sync:{target:e.getNode(n)||n,value:t[21]}}}return 6===t[12]?{type:"GET_BOUNDING_CLIENT_RECT",target:z(e,t[13])}:"Unrecognized MessageToWorker type: "+t[12]}(this.nodeContext,e)),this.config.onSendMessage&&this.config.onSendMessage(e),this.worker.postMessage(e,t||[])}},{key:"worker",get:function(){return this[55]}}]),e}(),W=function(){function e(){t(this,e),this.objects=new Map}return r(e,[{key:"store",value:function(e,t){this.objects.set(e,t)}},{key:"get",value:function(e){var t=this.objects.get(e);if(t)return t;throw Error("Object with id ("+e+") does not exist.")}}]),e}(),D=[3,2];return e.upgradeElement=function(e,t){var n=e.getAttribute("src");return n?f(e,{authorURL:n,domURL:t}):Promise.resolve(null)},e}({});
//# sourceMappingURL=main.js.map
